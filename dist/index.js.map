{"version":3,"file":"index.js","sources":["../src/utils.js","../src/historyStack.js","../src/helper.js","../src/extension.js","../src/index.js"],"sourcesContent":["export const isDef = function (v) {\n  return v !== undefined && v !== null;\n};\nconst PLACEHOLDER_VM = {\n  __placeholder: true,\n};\nexport const resolvePushedVm = (currentVm) => {\n  return (isDef(currentVm) && currentVm.$vnode.data.keepAlive) ? currentVm : PLACEHOLDER_VM;\n};\nexport const isPlaceHolderVm = (vm) => vm && !!vm.__placeholder;\n\nexport const getStateId = function () {\n  const state = getCurrentState();\n  return isDef(state) ? state.id : undefined;\n};\n\nexport const getQuery = function (params) {\n  let query = '';\n  query = Object.keys(params)\n    .map(\n      (key) => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`\n    )\n    .join('&');\n  if (query.length > 0) {\n    query = `?${query}`;\n  }\n  return query;\n};\nconst getCurrentState = function () {\n  return history.state;\n};\n\nexport const genKey = function (num, router) {\n  return `keep-alive-vnode-key${Number(num)}${router.history.current.path}`;\n};\nexport const getCurrentVM = function (router) {\n  return router.history.current.matched.length > 0\n    ? router.history.current.matched[0].instances.default\n    : undefined;\n};\nexport const setCurrentVnodeKey = function (router, key) {\n  const current = getCurrentVM(router);\n  if (current && current._vnode) {\n    current._vnode.parent.key = key;\n  }\n};\nexport const replaceFirstKeyAndCache = function (vm, key) {\n  if (!isDef(vm) || !isDef(vm.cache) || !isDef(vm.keys)) {\n    return;\n  }\n  const keys = vm.keys;\n  const cache = vm.cache;\n  if (keys.length === 1) {\n    const vnode = cache[keys[0]];\n    delete cache[keys[0]];\n    keys.splice(0, 1);\n    keys.push(key);\n    cache[key] = vnode;\n  }\n};\nexport const getFirstComponentChild = function (children) {\n  if (Array.isArray(children)) {\n    for (let i = 0; i < children.length; i++) {\n      const c = children[i];\n      if (isDef(c) && (isDef(c.componentOptions) || isAsyncPlaceholder(c))) {\n        return c;\n      }\n    }\n  }\n};\n\n\nexport const  getRealChild = function (vnode) {\n  const compOptions = vnode && vnode.componentOptions\n  if (compOptions && compOptions.Ctor.options.abstract) {\n    return getRealChild(getFirstComponentChild(compOptions.children))\n  } else {\n    return vnode\n  }\n}\n\nconst isAsyncPlaceholder = function (node) {\n  return node.isComment && node.asyncFactory;\n};\n\nexport const replaceState = function (mode, router, id) {\n  const { pathname, search, hash } = window.location;\n  let path = `${pathname}${search}${hash}`;\n  let state = isDef(history.state) ? history.state : {};\n  state['id'] = id;\n  // optimize file:// URL\n  const isFilSys = window.location.href.startsWith('file://');\n  history.replaceState(state, '', isFilSys ? null : path);\n};\n\nexport const inBrowser = typeof window !== 'undefined';\n\n\n\n\nexport function cached (fn) {\n  const cache = Object.create(null)\n  return (function cachedFn (str) {\n    const hit = cache[str]\n    return hit || (cache[str] = fn(str))\n  })\n}\n\n/**\n * Camelize a hyphen-delimited string.\n */\nconst camelizeRE = /-(\\w)/g\nexport const camelize = cached((str) => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n})\n\nexport function extend (to, _from) {\n  for (const key in _from) {\n    to[key] = _from[key]\n  }\n  return to\n}\n\nexport function isPrimitive (value) {\n  return (\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    // $flow-disable-line\n    typeof value === 'symbol' ||\n    typeof value === 'boolean'\n  )\n}\n\nexport const getStateForward = function () {\n  const state = getCurrentState();\n  return isDef(state) ? state.__forward : undefined;\n}\n\nexport const setStateForward = function (_path) {\n  const { pathname, search, hash } = window.location;\n  let path = `${pathname}${search}${hash}`;\n  let state = isDef(history.state) ? history.state : {};\n  state['__forward'] = _path;\n  // optimize file:// URL\n  const isFilSys = window.location.href.startsWith('file://');\n  history.replaceState(state, '', isFilSys ? null : path);\n}","export default class HistoryStack {\n  constructor() {\n    this.historyStackMap = [];\n  }\n  push(vm, index) {\n    // const cur = stackPointer();\n    const stack = this.historyStackMap[index];\n    if (Array.isArray(stack)) {\n      !stack.includes(vm) && stack.push(vm);\n      this.historyStackMap[index] = stack.filter((item) => !item._isDestroyed);\n    } else {\n      const vms = [];\n      vms.push(vm);\n      this.historyStackMap[index] = vms;\n    }\n  }\n  pop(vmCurrent) {\n    const last = this.historyStackMap.pop();\n    Array.isArray(last) &&\n      last.forEach(\n        (vm) => vm && vm.$keepAliveDestroy && vm.$keepAliveDestroy(vmCurrent)\n      );\n  }\n  removeGreater(index) {\n    while (this.historyStackMap.length >= index) {\n      this.pop();\n    }\n  }\n  clear() {\n    this.historyStackMap = [];\n  }\n}\n","import {\n  getCurrentVM,\n  isDef,\n  getStateId,\n  resolvePushedVm,\n  genKey,\n  replaceFirstKeyAndCache,\n  getFirstComponentChild,\n  isPlaceHolderVm,\n  setCurrentVnodeKey,\n  replaceState,\n  getRealChild,\n  getStateForward,\n  setStateForward,\n} from './utils';\nimport HistoryStack from './historyStack';\n\nexport default class VueRouterKeepAliveHelper {\n  constructor({ Vue, router, replaceStay }) {\n    this.Vue = Vue;\n    this.router = router;\n    this.router._stack = 0;\n    this.mode = router.mode; // hash or history\n    this.historyShouldChange = false;\n    this.isReplace = false;\n    this.replacePrePath = undefined;\n    this.preStateId = 0;\n    this.pre = null;\n    this.replaceStay = replaceStay || [];\n    this.hacked = false;\n    this.historyStack = new HistoryStack();\n    this.getTransitionName = ()=>{}\n    this.init();\n  }\n  init() {\n    this.routerHooks();\n    this.hackRouter();\n  }\n  \n  setTransitionNameHandler(fn) {\n    this.getTransitionName = fn\n  }\n  /**\n   * use afterEach hook to set state.key and add the reference of vm to the historyStack\n   */\n  routerHooks() {\n    const router = this.router;\n    router.afterEach((to, from) => {\n      setStateForward(to.fullPath)\n      this.historyShouldChange = true;\n      // get the vm instance after render\n      this.Vue.nextTick(() => {\n        const current = this.currentVm;\n        const pendingToPushVm = resolvePushedVm(current);\n        if (this.pre === null) {\n          this.onInitial(pendingToPushVm);\n        } else if (this.isReplace) {\n          this.onReplace(pendingToPushVm);\n        } else if (this.isPush) {\n          this.onPush(pendingToPushVm);\n        } else {\n          this.onBack(pendingToPushVm);\n        }\n        // console.log(current)\n        this.pre = current;\n        this.preStateId = this.stackPointer;\n        if (!isPlaceHolderVm(pendingToPushVm)) {\n          setCurrentVnodeKey(router, genKey(this.stackPointer, router));\n          if (!this.hacked && current) {\n            this.hackKeepAliveRender(current.$vnode.parent.componentInstance);\n            if (current.$vnode.parent?.parent?.componentOptions?.tag === 'transition') {\n              this.hackTransitionRender(current.$vnode.parent?.parent.componentInstance);\n            }\n          }\n          this.historyShouldChange = false;\n        }\n      });\n    });\n  }\n  /**\n   * @description hack router go , replace and push functions to tell replace from back and push\n   */\n  hackRouter() {\n    const router = this.router;\n    const rtmp = router.replace;\n    const rtmpf = (location, onComplete, onAbort) => {\n      this.isReplace = true;\n      this.replacePrePath = router.history.current.path;\n      rtmp.call(router, location, onComplete, (e) => {\n        this.isReplace = false;\n        this.replacePrePath = undefined;\n        isDef(onAbort) && onAbort(e);\n      });\n    };\n    router.replace = function (location, onComplete, onAbort) {\n      rtmpf(location, onComplete, onAbort);\n    };\n\n    const gstmp = router.go;\n    const gstmpf = (number) => {\n      this.isReplace = false;\n      return gstmp.call(router, number);\n    };\n    router.go = function (num) {\n      return gstmpf(num);\n    };\n    const pstmp = router.push;\n    const pstmpf = (location, onComplete, onAbort) => {\n      this.isReplace = false;\n      if (!onComplete && !onAbort && typeof Promise !== 'undefined') {\n        return pstmp.call(router, location, onComplete, onAbort);\n      } else {\n        pstmp.call(router, location, onComplete, onAbort);\n      }\n    };\n    router.push = function (location, onComplete, onAbort) {\n      return pstmpf(location, onComplete, onAbort);\n    };\n  }\n  /**\n   * @description hack the render function of keep-alive component, modify the key of vnode for cache\n   * @param {*} vm keep-alive component instance\n   */\n  hackKeepAliveRender(vm) {\n    // modify the first keep alive key and cache\n    replaceFirstKeyAndCache(vm, genKey(this.stackPointer, this.router));\n\n    const tmp = vm.$options.render;\n    const self = this;\n    const router = this.router;\n    vm.$options.render = function () {\n      const slot = this.$slots.default;\n      const vnode = getFirstComponentChild(slot); // vnode is a keep-alive-component-vnode\n      if (self.historyShouldChange) {\n        if (vnode && !isDef(vnode.key)) {\n          if (self.isReplace) {\n            vnode.key = genKey(self.stackPointer, router);\n          } else if (self.isPush) {\n            vnode.key = genKey(self.stackPointer + 1, router);\n          } else {\n            vnode.key = genKey(self.stackPointer - 1, router);\n          }\n        }\n      } else {\n        if (vnode && !isDef(vnode.key)) {\n          // when historyShouldChange is false should rerender only, should not create new vm ,use the same vnode.key issue#7\n          vnode.key = genKey(self.stackPointer, router);\n        }\n      }\n      return tmp.apply(this, arguments);\n    };\n    this.hacked = true;\n  }\n  /**\n   * @description hack the render function of transition component, modify the key and transition-name of vnode when use <transition>\n   * @param {*} vm transition component instance\n   */\n  hackTransitionRender(vm) {\n    const tmp = vm.$options.render;\n    const self = this;\n    const router = this.router;\n    vm.$options.render = function () {\n      const slot = this.$slots.default;\n      let _key = ''\n      if (slot.length > 0) {\n        const vnode = getRealChild(slot[0]); // vnode is a keep-alive-component-vnode\n        if (self.historyShouldChange) {\n          if (vnode && !isDef(vnode.key)) {\n            if (self.isReplace) {\n              vnode.key = genKey(self.stackPointer, router);\n            } else if (self.isPush) {\n              vnode.key = genKey(self.stackPointer + 1, router);\n            } else {\n              vnode.key = genKey(self.stackPointer - 1, router);\n            }\n          }\n        } else {\n          // when historyShouldChange is false should rerender only, should not create new vm ,use the same vnode.key issue#7\n          if (vnode && !isDef(vnode.key)) {\n            vnode.key = genKey(self.stackPointer, router);\n          }\n        }\n        _key = vnode.key\n      }\n      const res =  tmp.apply(this, arguments);\n      // after render ,replace the key and update transition name\n      if (_key.length > 0) {\n        const vnode = getRealChild(slot[0])\n        vnode.key = _key\n        if (vnode && vnode.data && vnode.data.transition) {\n          vnode.data.transition.name = self.getTransitionName()\n          if (slot && slot.length > 0 && slot[0] && slot[0].context.$children) {\n            const len = slot[0].context.$children.length\n            const preVnode = slot[0].context.$children[len-1].$vnode\n            if (preVnode && preVnode.data && preVnode.data.transition) {\n              preVnode.data.transition.name = self.getTransitionName()\n            }\n          }\n        }\n      }\n      return res \n    };\n  }\n  /** ********  callback functions ************/\n  onInitial(vm) {\n    const currentStateId = getStateId();\n    if (isDef(currentStateId)) {\n      this.setStackPointer(currentStateId);\n    } else {\n      this.setState(0);\n    }\n    this.historyStack.push(vm, this.stackPointer);\n  }\n  onPush(vm) {\n    this.setState(this.increaseStackPointer());\n    this.historyStack.push(vm, this.stackPointer);\n    this.pre?.$clearParent?.(vm);\n    this.pre = null;\n  }\n  onBack(vm) {\n    this.historyStack.pop(vm);\n    this.decreaseStackPointer();\n    this.historyStack.push(vm, this.stackPointer);\n  }\n  onReplace(vm) {\n    // avoidReplaceQuery is fix the issue : router.replace only a query by same path, may cause error\n    const avoidReplaceQuery = this.replacePrePath === this.router.history.current.path\n    const shouldDestroy = !(\n      isDef(this.replacePrePath) &&\n      this.replaceStay.includes(this.replacePrePath)) && \n      !avoidReplaceQuery\n\n    if (shouldDestroy) {\n      this.pre?.$keepAliveDestroy?.(vm);\n    } else if (!avoidReplaceQuery) {\n      this.pre?.$clearParent?.(vm);\n    }\n    \n    this.pre = null;\n    this.setState(this.stackPointer);\n    this.historyStack.push(vm, this.stackPointer);\n    this.isReplace = false;\n    this.replacePrePath = undefined;\n  }\n  get isBacking() {\n    return !(this.isPush || this.isReplace)\n  }\n  get currentVm() {\n    return getCurrentVM(this.router);\n  }\n  get isPush() {\n    if (!this.isReplace) {\n      const stateId = getStateId();\n      return !isDef(stateId) || this.preStateId <= stateId;\n    }\n    return false;\n  }\n  get stackPointer() {\n    return this.router._stack;\n  }\n  setState(id) {\n    this.setStackPointer(id);\n    replaceState(this.mode, this.router, id);\n  }\n  setStackPointer(val) {\n    this.router._stack = val;\n  }\n  increaseStackPointer() {\n    return (this.router._stack += 1);\n  }\n  decreaseStackPointer() {\n    return (this.router._stack -= 1);\n  }\n}\n","import { isDef } from './utils';\n\nexport function extendHistory(history) {\n  const rstmp = history.replaceState;\n  history.replaceState = function (state, op, path) {\n    const old = Object.assign({}, history.state);\n    const s = Object.assign(old, state);\n    rstmp.call(history, s, op, path);\n  };\n  const historyPushState = history.pushState;\n  history.pushState = function (state, op, path) {\n    const old = Object.assign({}, history.state);\n    const s = Object.assign(old, state);\n    historyPushState.call(history, s, op, path);\n  };\n}\n\nexport function extendVue(Vue) {\n  const dtmp = Vue.prototype.$destroy;\n  /**\n   * @description remove the cache in <keep-alive> component before invoke $destroy\n   */\n  Vue.prototype.$keepAliveDestroy = function (vmCurrent) {\n    if (this.$vnode && this.$vnode.data.keepAlive) {\n      if (\n        this.$vnode.parent &&\n        this.$vnode.parent.componentInstance &&\n        this.$vnode.parent.componentInstance.cache\n      ) {\n        if (this.$vnode.componentOptions) {\n          const key = !isDef(this.$vnode.key)\n            ? this.$vnode.componentOptions.Ctor.cid +\n              (this.$vnode.componentOptions.tag\n                ? `::${this.$vnode.componentOptions.tag}`\n                : '')\n            : this.$vnode.key;\n          const cache = this.$vnode.parent.componentInstance.cache;\n          const keys = this.$vnode.parent.componentInstance.keys;\n          if (cache[key]) {\n            if (keys.length) {\n              const index = keys.indexOf(key);\n              if (index > -1) {\n                keys.splice(index, 1);\n              }\n            }\n            cache[key] = null;\n            // fix memory leaks\n            if (\n              this.$vnode.parent && this.$vnode.parent.componentOptions && this.$vnode.parent.componentOptions.children &&\n              Array.isArray(this.$vnode.parent.componentOptions.children)\n            ) {\n              this.$vnode.parent.componentOptions.children.length = 0\n            }\n            if (cache[vmCurrent.$vnode.key] && cache[vmCurrent.$vnode.key].parent && cache[vmCurrent.$vnode.key].parent.componentOptions) {\n              cache[vmCurrent.$vnode.key].parent.componentOptions.children = [cache[vmCurrent.$vnode.key]]\n              cache[vmCurrent.$vnode.key].parent.elm = cache[vmCurrent.$vnode.key].parent.componentInstance.$el\n            }\n            if (\n              this.$parent.$children &&\n              Array.isArray(this.$parent.$children)\n            ) {\n              const index = this.$parent.$children.indexOf(this);\n              if (index >= 0) {\n                this.$parent.$children.splice(index, 1);\n              }\n            }\n          }\n        }\n      }\n    }\n    dtmp.apply(this, arguments);\n  };\n  Vue.prototype.$clearParent = function (vmCurrent) {\n    if (this.$vnode && this.$vnode.data.keepAlive) {\n      if (\n        this.$vnode.parent &&\n        this.$vnode.parent.componentInstance &&\n        this.$vnode.parent.componentInstance.cache\n      ) {\n        if (this.$vnode.componentOptions) {\n          const key = !isDef(this.$vnode.key)\n            ? this.$vnode.componentOptions.Ctor.cid +\n              (this.$vnode.componentOptions.tag\n                ? `::${this.$vnode.componentOptions.tag}`\n                : '')\n            : this.$vnode.key;\n          const cache = this.$vnode.parent.componentInstance.cache;\n          if (cache[key]) {\n            // fix memory leaks\n            if (\n              this.$vnode.parent && this.$vnode.parent.componentOptions && this.$vnode.parent.componentOptions.children &&\n              Array.isArray(this.$vnode.parent.componentOptions.children)\n            ) {\n              this.$vnode.parent.componentOptions.children.length = 0\n            }\n            if (cache[vmCurrent.$vnode.key] && cache[vmCurrent.$vnode.key].parent && cache[vmCurrent.$vnode.key].parent.componentOptions) {\n              cache[vmCurrent.$vnode.key].parent.componentOptions.children = [cache[vmCurrent.$vnode.key]]\n              cache[vmCurrent.$vnode.key].parent.elm = cache[vmCurrent.$vnode.key].parent.componentInstance.$el\n            }\n            // if (\n            //   this.$parent.$children &&\n            //   Array.isArray(this.$parent.$children)\n            // ) {\n            //   const index = this.$parent.$children.indexOf(this);\n            //   if (index >= 0) {\n            //     this.$parent.$children.splice(index, 1);\n            //   }\n            // }\n          }\n        }\n      }\n    }\n  };\n}\n","import Helper from './helper';\nimport { extendVue, extendHistory } from './extension';\nimport { inBrowser } from './utils';\n\nlet singleton;\n// TODO: 1. abstract mode support\nexport default function createHelper(config) {\n  if (singleton) {\n    return singleton;\n  }\n  if (config.Vue === undefined || config.router === undefined) {\n    console.warn(\n      'warning: router helper needs Vue and root router ,see more for guide : https://github.com/Zippowxk/vue-router-keep-alive-helper'\n    );\n    return;\n  }\n  if (inBrowser) {\n    extendHistory(window.history);\n  }\n  extendVue(config.Vue);\n  return (singleton = new Helper(config));\n}\n"],"names":["isDef","v","undefined","PLACEHOLDER_VM","__placeholder","resolvePushedVm","currentVm","$vnode","data","keepAlive","isPlaceHolderVm","vm","getStateId","state","getCurrentState","id","history","genKey","num","router","Number","current","path","getCurrentVM","matched","length","instances","default","setCurrentVnodeKey","key","_vnode","parent","replaceFirstKeyAndCache","cache","keys","vnode","splice","push","getFirstComponentChild","children","Array","isArray","i","c","componentOptions","isAsyncPlaceholder","getRealChild","compOptions","Ctor","options","abstract","node","isComment","asyncFactory","replaceState","mode","window","location","pathname","search","hash","isFilSys","href","startsWith","inBrowser","setStateForward","_path","HistoryStack","historyStackMap","index","stack","includes","filter","item","_isDestroyed","vms","pop","vmCurrent","last","forEach","$keepAliveDestroy","removeGreater","clear","VueRouterKeepAliveHelper","Vue","replaceStay","_stack","historyShouldChange","isReplace","replacePrePath","preStateId","pre","hacked","historyStack","getTransitionName","init","routerHooks","hackRouter","setTransitionNameHandler","fn","afterEach","to","from","fullPath","nextTick","pendingToPushVm","onInitial","onReplace","isPush","onPush","onBack","stackPointer","hackKeepAliveRender","componentInstance","tag","hackTransitionRender","rtmp","replace","rtmpf","onComplete","onAbort","call","e","gstmp","go","gstmpf","number","pstmp","pstmpf","Promise","tmp","$options","render","self","slot","$slots","apply","arguments","_key","res","transition","name","context","$children","len","preVnode","currentStateId","setStackPointer","setState","increaseStackPointer","$clearParent","decreaseStackPointer","avoidReplaceQuery","shouldDestroy","val","stateId","extendHistory","rstmp","op","old","Object","assign","s","historyPushState","pushState","extendVue","dtmp","prototype","$destroy","cid","indexOf","elm","$el","$parent","singleton","createHelper","config","console","warn","Helper"],"mappings":"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"}