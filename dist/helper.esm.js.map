{"version":3,"file":"helper.esm.js","sources":["../src/utils.js","../src/index.js","../src/historyStack.js","../src/helper.js","../src/extension.js"],"sourcesContent":["export const isDef = function (v) {\n  return v !== undefined && v !== null;\n};\nconst PLACEHOLDER_VM = {\n  __placeholder: true,\n};\nexport const resolvePushedVm = (currentVm) => {\n  return (isDef(currentVm) && currentVm.$vnode.data.keepAlive) ? currentVm : PLACEHOLDER_VM;\n};\nexport const isPlaceHolderVm = (vm) => vm && !!vm.__placeholder;\n\nexport const getStateId = function () {\n  const state = getCurrentState();\n  return isDef(state) ? state.id : undefined;\n};\n\nexport const getQuery = function (params) {\n  let query = '';\n  query = Object.keys(params)\n    .map(\n      (key) => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`\n    )\n    .join('&');\n  if (query.length > 0) {\n    query = `?${query}`;\n  }\n  return query;\n};\nconst getCurrentState = function () {\n  return history.state;\n};\n\nexport const genKey = function (num, router) {\n  return `keep-alive-vnode-key${Number(num)}${router.history.current.path}`;\n};\nexport const getCurrentVM = function (router) {\n  return router.history.current.matched.length > 0\n    ? router.history.current.matched[0].instances.default\n    : undefined;\n};\nexport const setCurrentVnodeKey = function (router, key) {\n  const current = getCurrentVM(router);\n  if (current && current._vnode) {\n    current._vnode.parent.key = key;\n  }\n};\nexport const replaceFirstKeyAndCache = function (vm, key) {\n  if (!isDef(vm) || !isDef(vm.cache) || !isDef(vm.keys)) {\n    return;\n  }\n  const keys = vm.keys;\n  const cache = vm.cache;\n  if (keys.length === 1) {\n    const vnode = cache[keys[0]];\n    delete cache[keys[0]];\n    keys.splice(0, 1);\n    keys.push(key);\n    cache[key] = vnode;\n  }\n};\nexport const getFirstComponentChild = function (children) {\n  if (Array.isArray(children)) {\n    for (let i = 0; i < children.length; i++) {\n      const c = children[i];\n      if (isDef(c) && (isDef(c.componentOptions) || isAsyncPlaceholder(c))) {\n        return c;\n      }\n    }\n  }\n};\n\n\nexport const  getRealChild = function (vnode) {\n  const compOptions = vnode && vnode.componentOptions\n  if (compOptions && compOptions.Ctor.options.abstract) {\n    return getRealChild(getFirstComponentChild(compOptions.children))\n  } else {\n    return vnode\n  }\n}\n\nconst isAsyncPlaceholder = function (node) {\n  return node.isComment && node.asyncFactory;\n};\n\nexport const replaceState = function (mode, router, id) {\n  const { pathname, search, hash } = window.location;\n  let path = `${pathname}${search}${hash}`;\n  let state = isDef(history.state) ? history.state : {};\n  state['id'] = id;\n  // optimize file:// URL\n  const isFilSys = window.location.href.startsWith('file://');\n  history.replaceState(state, '', isFilSys ? null : path);\n};\n\nexport const inBrowser = typeof window !== 'undefined';\n\n\n\n\nexport function cached (fn) {\n  const cache = Object.create(null)\n  return (function cachedFn (str) {\n    const hit = cache[str]\n    return hit || (cache[str] = fn(str))\n  })\n}\n\n/**\n * Camelize a hyphen-delimited string.\n */\nconst camelizeRE = /-(\\w)/g\nexport const camelize = cached((str) => {\n  return str.replace(camelizeRE, (_, c) => c ? c.toUpperCase() : '')\n})\n\nexport function extend (to, _from) {\n  for (const key in _from) {\n    to[key] = _from[key]\n  }\n  return to\n}\n\nexport function isPrimitive (value) {\n  return (\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    // $flow-disable-line\n    typeof value === 'symbol' ||\n    typeof value === 'boolean'\n  )\n}\n\nexport const getStateForward = function () {\n  const state = getCurrentState();\n  return isDef(state) ? state.__forward : undefined;\n}\n\nexport const setStateForward = function (_path) {\n  const { pathname, search, hash } = window.location;\n  let path = `${pathname}${search}${hash}`;\n  let state = isDef(history.state) ? history.state : {};\n  state['__forward'] = _path;\n  // optimize file:// URL\n  const isFilSys = window.location.href.startsWith('file://');\n  history.replaceState(state, '', isFilSys ? null : path);\n}","import Helper from './helper';\nimport { extendVue, extendHistory } from './extension';\nimport { inBrowser } from './utils';\n\nlet singleton;\n// TODO: 1. abstract mode support\nexport default function createHelper(config) {\n  if (singleton) {\n    return singleton;\n  }\n  if (config.Vue === undefined || config.router === undefined) {\n    console.warn(\n      'warning: router helper needs Vue and root router ,see more for guide : https://github.com/Zippowxk/vue-router-keep-alive-helper'\n    );\n    return;\n  }\n  if (inBrowser) {\n    extendHistory(window.history);\n  }\n  extendVue(config.Vue);\n  return (singleton = new Helper(config));\n}\n","export default class HistoryStack {\n  constructor() {\n    this.historyStackMap = [];\n  }\n  push(vm, index) {\n    // const cur = stackPointer();\n    const stack = this.historyStackMap[index];\n    if (Array.isArray(stack)) {\n      !stack.includes(vm) && stack.push(vm);\n      this.historyStackMap[index] = stack.filter((item) => !item._isDestroyed);\n    } else {\n      const vms = [];\n      vms.push(vm);\n      this.historyStackMap[index] = vms;\n    }\n  }\n  pop(vmCurrent) {\n    const last = this.historyStackMap.pop();\n    Array.isArray(last) &&\n      last.forEach(\n        (vm) => vm && vm.$keepAliveDestroy && vm.$keepAliveDestroy(vmCurrent)\n      );\n  }\n  removeGreater(index) {\n    while (this.historyStackMap.length >= index) {\n      this.pop();\n    }\n  }\n  clear() {\n    this.historyStackMap = [];\n  }\n}\n","import {\n  getCurrentVM,\n  isDef,\n  getStateId,\n  resolvePushedVm,\n  genKey,\n  replaceFirstKeyAndCache,\n  getFirstComponentChild,\n  isPlaceHolderVm,\n  setCurrentVnodeKey,\n  replaceState,\n  getRealChild,\n  getStateForward,\n  setStateForward,\n} from './utils';\nimport HistoryStack from './historyStack';\n\nexport default class VueRouterKeepAliveHelper {\n  constructor({ Vue, router, replaceStay }) {\n    this.Vue = Vue;\n    this.router = router;\n    this.router._stack = 0;\n    this.mode = router.mode; // hash or history\n    this.historyShouldChange = false;\n    this.isReplace = false;\n    this.replacePrePath = undefined;\n    this.preStateId = 0;\n    this.pre = null;\n    this.replaceStay = replaceStay || [];\n    this.hacked = false;\n    this.historyStack = new HistoryStack();\n    this.getTransitionName = ()=>{}\n    this.init();\n  }\n  init() {\n    this.routerHooks();\n    this.hackRouter();\n  }\n  \n  setTransitionNameHandler(fn) {\n    this.getTransitionName = fn\n  }\n  /**\n   * use afterEach hook to set state.key and add the reference of vm to the historyStack\n   */\n  routerHooks() {\n    const router = this.router;\n    router.afterEach((to, from) => {\n      setStateForward(to.fullPath)\n      this.historyShouldChange = true;\n      // get the vm instance after render\n      this.Vue.nextTick(() => {\n        const current = this.currentVm;\n        const pendingToPushVm = resolvePushedVm(current);\n        if (this.pre === null) {\n          this.onInitial(pendingToPushVm);\n        } else if (this.isReplace) {\n          this.onReplace(pendingToPushVm);\n        } else if (this.isPush) {\n          this.onPush(pendingToPushVm);\n        } else {\n          this.onBack(pendingToPushVm);\n        }\n        // console.log(current)\n        this.pre = current;\n        this.preStateId = this.stackPointer;\n        if (!isPlaceHolderVm(pendingToPushVm)) {\n          setCurrentVnodeKey(router, genKey(this.stackPointer, router));\n          if (!this.hacked && current) {\n            this.hackKeepAliveRender(current.$vnode.parent.componentInstance);\n            if (current.$vnode.parent?.parent?.componentOptions?.tag === 'transition') {\n              this.hackTransitionRender(current.$vnode.parent?.parent.componentInstance);\n            }\n          }\n          this.historyShouldChange = false;\n        }\n      });\n    });\n  }\n  /**\n   * @description hack router go , replace and push functions to tell replace from back and push\n   */\n  hackRouter() {\n    const router = this.router;\n    const rtmp = router.replace;\n    const rtmpf = (location, onComplete, onAbort) => {\n      this.isReplace = true;\n      this.replacePrePath = router.history.current.path;\n      rtmp.call(router, location, onComplete, (e) => {\n        this.isReplace = false;\n        this.replacePrePath = undefined;\n        isDef(onAbort) && onAbort(e);\n      });\n    };\n    router.replace = function (location, onComplete, onAbort) {\n      rtmpf(location, onComplete, onAbort);\n    };\n\n    const gstmp = router.go;\n    const gstmpf = (number) => {\n      this.isReplace = false;\n      return gstmp.call(router, number);\n    };\n    router.go = function (num) {\n      return gstmpf(num);\n    };\n    const pstmp = router.push;\n    const pstmpf = (location, onComplete, onAbort) => {\n      this.isReplace = false;\n      if (!onComplete && !onAbort && typeof Promise !== 'undefined') {\n        return pstmp.call(router, location, onComplete, onAbort);\n      } else {\n        pstmp.call(router, location, onComplete, onAbort);\n      }\n    };\n    router.push = function (location, onComplete, onAbort) {\n      return pstmpf(location, onComplete, onAbort);\n    };\n  }\n  /**\n   * @description hack the render function of keep-alive component, modify the key of vnode for cache\n   * @param {*} vm keep-alive component instance\n   */\n  hackKeepAliveRender(vm) {\n    // modify the first keep alive key and cache\n    replaceFirstKeyAndCache(vm, genKey(this.stackPointer, this.router));\n\n    const tmp = vm.$options.render;\n    const self = this;\n    const router = this.router;\n    vm.$options.render = function () {\n      const slot = this.$slots.default;\n      const vnode = getFirstComponentChild(slot); // vnode is a keep-alive-component-vnode\n      if (self.historyShouldChange) {\n        if (vnode && !isDef(vnode.key)) {\n          if (self.isReplace) {\n            vnode.key = genKey(self.stackPointer, router);\n          } else if (self.isPush) {\n            vnode.key = genKey(self.stackPointer + 1, router);\n          } else {\n            vnode.key = genKey(self.stackPointer - 1, router);\n          }\n        }\n      } else {\n        if (vnode && !isDef(vnode.key)) {\n          // when historyShouldChange is false should rerender only, should not create new vm ,use the same vnode.key issue#7\n          vnode.key = genKey(self.stackPointer, router);\n        }\n      }\n      return tmp.apply(this, arguments);\n    };\n    this.hacked = true;\n  }\n  /**\n   * @description hack the render function of transition component, modify the key and transition-name of vnode when use <transition>\n   * @param {*} vm transition component instance\n   */\n  hackTransitionRender(vm) {\n    const tmp = vm.$options.render;\n    const self = this;\n    const router = this.router;\n    vm.$options.render = function () {\n      const slot = this.$slots.default;\n      let _key = ''\n      if (slot.length > 0) {\n        const vnode = getRealChild(slot[0]); // vnode is a keep-alive-component-vnode\n        if (self.historyShouldChange) {\n          if (vnode && !isDef(vnode.key)) {\n            if (self.isReplace) {\n              vnode.key = genKey(self.stackPointer, router);\n            } else if (self.isPush) {\n              vnode.key = genKey(self.stackPointer + 1, router);\n            } else {\n              vnode.key = genKey(self.stackPointer - 1, router);\n            }\n          }\n        } else {\n          // when historyShouldChange is false should rerender only, should not create new vm ,use the same vnode.key issue#7\n          if (vnode && !isDef(vnode.key)) {\n            vnode.key = genKey(self.stackPointer, router);\n          }\n        }\n        _key = vnode.key\n      }\n      const res =  tmp.apply(this, arguments);\n      // after render ,replace the key and update transition name\n      if (_key.length > 0) {\n        const vnode = getRealChild(slot[0])\n        vnode.key = _key\n        if (vnode && vnode.data && vnode.data.transition) {\n          vnode.data.transition.name = self.getTransitionName()\n          if (slot && slot.length > 0 && slot[0] && slot[0].context.$children) {\n            const len = slot[0].context.$children.length\n            const preVnode = slot[0].context.$children[len-1].$vnode\n            if (preVnode && preVnode.data && preVnode.data.transition) {\n              preVnode.data.transition.name = self.getTransitionName()\n            }\n          }\n        }\n      }\n      return res \n    };\n  }\n  /** ********  callback functions ************/\n  onInitial(vm) {\n    const currentStateId = getStateId();\n    if (isDef(currentStateId)) {\n      this.setStackPointer(currentStateId);\n    } else {\n      this.setState(0);\n    }\n    this.historyStack.push(vm, this.stackPointer);\n  }\n  onPush(vm) {\n    this.setState(this.increaseStackPointer());\n    this.historyStack.push(vm, this.stackPointer);\n    this.pre?.$clearParent?.(vm);\n    this.pre = null;\n  }\n  onBack(vm) {\n    this.historyStack.pop(vm);\n    this.decreaseStackPointer();\n    this.historyStack.push(vm, this.stackPointer);\n  }\n  onReplace(vm) {\n    // avoidReplaceQuery is fix the issue : router.replace only a query by same path, may cause error\n    const avoidReplaceQuery = this.replacePrePath === this.router.history.current.path\n    const shouldDestroy = !(\n      isDef(this.replacePrePath) &&\n      this.replaceStay.includes(this.replacePrePath)) && \n      !avoidReplaceQuery\n\n    if (shouldDestroy) {\n      this.pre?.$keepAliveDestroy?.(vm);\n    } else if (!avoidReplaceQuery) {\n      this.pre?.$clearParent?.(vm);\n    }\n    \n    this.pre = null;\n    this.setState(this.stackPointer);\n    this.historyStack.push(vm, this.stackPointer);\n    this.isReplace = false;\n    this.replacePrePath = undefined;\n  }\n  get isBacking() {\n    return !(this.isPush || this.isReplace)\n  }\n  get currentVm() {\n    return getCurrentVM(this.router);\n  }\n  get isPush() {\n    if (!this.isReplace) {\n      const stateId = getStateId();\n      return !isDef(stateId) || this.preStateId <= stateId;\n    }\n    return false;\n  }\n  get stackPointer() {\n    return this.router._stack;\n  }\n  setState(id) {\n    this.setStackPointer(id);\n    replaceState(this.mode, this.router, id);\n  }\n  setStackPointer(val) {\n    this.router._stack = val;\n  }\n  increaseStackPointer() {\n    return (this.router._stack += 1);\n  }\n  decreaseStackPointer() {\n    return (this.router._stack -= 1);\n  }\n}\n","import { isDef } from './utils';\n\nexport function extendHistory(history) {\n  const rstmp = history.replaceState;\n  history.replaceState = function (state, op, path) {\n    const old = Object.assign({}, history.state);\n    const s = Object.assign(old, state);\n    rstmp.call(history, s, op, path);\n  };\n  const historyPushState = history.pushState;\n  history.pushState = function (state, op, path) {\n    const old = Object.assign({}, history.state);\n    const s = Object.assign(old, state);\n    historyPushState.call(history, s, op, path);\n  };\n}\n\nexport function extendVue(Vue) {\n  const dtmp = Vue.prototype.$destroy;\n  /**\n   * @description remove the cache in <keep-alive> component before invoke $destroy\n   */\n  Vue.prototype.$keepAliveDestroy = function (vmCurrent) {\n    if (this.$vnode && this.$vnode.data.keepAlive) {\n      if (\n        this.$vnode.parent &&\n        this.$vnode.parent.componentInstance &&\n        this.$vnode.parent.componentInstance.cache\n      ) {\n        if (this.$vnode.componentOptions) {\n          const key = !isDef(this.$vnode.key)\n            ? this.$vnode.componentOptions.Ctor.cid +\n              (this.$vnode.componentOptions.tag\n                ? `::${this.$vnode.componentOptions.tag}`\n                : '')\n            : this.$vnode.key;\n          const cache = this.$vnode.parent.componentInstance.cache;\n          const keys = this.$vnode.parent.componentInstance.keys;\n          if (cache[key]) {\n            if (keys.length) {\n              const index = keys.indexOf(key);\n              if (index > -1) {\n                keys.splice(index, 1);\n              }\n            }\n            cache[key] = null;\n            // fix memory leaks\n            if (\n              this.$vnode.parent && this.$vnode.parent.componentOptions && this.$vnode.parent.componentOptions.children &&\n              Array.isArray(this.$vnode.parent.componentOptions.children)\n            ) {\n              this.$vnode.parent.componentOptions.children.length = 0\n            }\n            if (cache[vmCurrent.$vnode.key] && cache[vmCurrent.$vnode.key].parent && cache[vmCurrent.$vnode.key].parent.componentOptions) {\n              cache[vmCurrent.$vnode.key].parent.componentOptions.children = [cache[vmCurrent.$vnode.key]]\n              cache[vmCurrent.$vnode.key].parent.elm = cache[vmCurrent.$vnode.key].parent.componentInstance.$el\n            }\n            if (\n              this.$parent.$children &&\n              Array.isArray(this.$parent.$children)\n            ) {\n              const index = this.$parent.$children.indexOf(this);\n              if (index >= 0) {\n                this.$parent.$children.splice(index, 1);\n              }\n            }\n          }\n        }\n      }\n    }\n    dtmp.apply(this, arguments);\n  };\n  Vue.prototype.$clearParent = function (vmCurrent) {\n    if (this.$vnode && this.$vnode.data.keepAlive) {\n      if (\n        this.$vnode.parent &&\n        this.$vnode.parent.componentInstance &&\n        this.$vnode.parent.componentInstance.cache\n      ) {\n        if (this.$vnode.componentOptions) {\n          const key = !isDef(this.$vnode.key)\n            ? this.$vnode.componentOptions.Ctor.cid +\n              (this.$vnode.componentOptions.tag\n                ? `::${this.$vnode.componentOptions.tag}`\n                : '')\n            : this.$vnode.key;\n          const cache = this.$vnode.parent.componentInstance.cache;\n          if (cache[key]) {\n            // fix memory leaks\n            if (\n              this.$vnode.parent && this.$vnode.parent.componentOptions && this.$vnode.parent.componentOptions.children &&\n              Array.isArray(this.$vnode.parent.componentOptions.children)\n            ) {\n              this.$vnode.parent.componentOptions.children.length = 0\n            }\n            if (cache[vmCurrent.$vnode.key] && cache[vmCurrent.$vnode.key].parent && cache[vmCurrent.$vnode.key].parent.componentOptions) {\n              cache[vmCurrent.$vnode.key].parent.componentOptions.children = [cache[vmCurrent.$vnode.key]]\n              cache[vmCurrent.$vnode.key].parent.elm = cache[vmCurrent.$vnode.key].parent.componentInstance.$el\n            }\n            // if (\n            //   this.$parent.$children &&\n            //   Array.isArray(this.$parent.$children)\n            // ) {\n            //   const index = this.$parent.$children.indexOf(this);\n            //   if (index >= 0) {\n            //     this.$parent.$children.splice(index, 1);\n            //   }\n            // }\n          }\n        }\n      }\n    }\n  };\n}\n"],"names":["singleton","isDef","v","PLACEHOLDER_VM","__placeholder","getStateId","state","getCurrentState","id","undefined","history","genKey","num","router","Number","current","path","getCurrentVM","matched","length","instances","default","getFirstComponentChild","children","Array","isArray","i","c","componentOptions","isAsyncPlaceholder","getRealChild","vnode","compOptions","Ctor","options","abstract","node","isComment","asyncFactory","inBrowser","window","HistoryStack","historyStackMap","push","vm","index","stack","this","includes","filter","item","_isDestroyed","vms","pop","vmCurrent","last","forEach","$keepAliveDestroy","removeGreater","clear","VueRouterKeepAliveHelper","Vue","replaceStay","_stack","mode","historyShouldChange","isReplace","replacePrePath","preStateId","pre","hacked","historyStack","getTransitionName","init","routerHooks","hackRouter","setTransitionNameHandler","fn","afterEach","to","from","_path","location","pathname","search","hash","isFilSys","href","startsWith","replaceState","setStateForward","fullPath","_this","nextTick","currentVm","pendingToPushVm","$vnode","data","keepAlive","onInitial","onReplace","isPush","onPush","onBack","stackPointer","key","_vnode","parent","setCurrentVnodeKey","hackKeepAliveRender","componentInstance","tag","hackTransitionRender","_current$$vnode$paren4","rtmp","replace","onComplete","onAbort","_this2","call","e","rtmpf","gstmp","go","number","pstmp","Promise","pstmpf","cache","keys","splice","replaceFirstKeyAndCache","tmp","$options","render","self","slot","$slots","apply","arguments","_key","res","transition","name","context","$children","len","preVnode","currentStateId","setStackPointer","setState","increaseStackPointer","$clearParent","decreaseStackPointer","avoidReplaceQuery","val","stateId","createHelper","config","rstmp","op","old","Object","assign","s","historyPushState","pushState","extendHistory","dtmp","prototype","$destroy","cid","indexOf","elm","$el","$parent","Helper","console","warn"],"mappings":"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"}