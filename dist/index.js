!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).createHelper=t()}(this,(function(){"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t,n=function(e){return null!=e},o={__placeholder:!0},i=function(){var e=r();return n(e)?e.id:void 0},r=function(){return history.state},s=function(e,t){return"keep-alive-vnode-key"+Number(e)+t.history.current.path},a=function(e){return e.history.current.matched.length>0?e.history.current.matched[0].instances.default:void 0},c=function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++){var o=e[t];if(n(o)&&(n(o.componentOptions)||h(o)))return o}},h=function(e){return e.isComment&&e.asyncFactory},p="undefined"!=typeof window,u=function(){function e(){this.historyStackMap=[]}var t=e.prototype;return t.push=function(e,t){var n=this.historyStackMap[t];if(Array.isArray(n))!n.includes(e)&&n.push(e),this.historyStackMap[t]=n.filter((function(e){return!e._isDestroyed}));else{var o=[];o.push(e),this.historyStackMap[t]=o}},t.pop=function(e){var t=this.historyStackMap.pop();Array.isArray(t)&&t.forEach((function(t){return t&&t.$keepAliveDestroy&&t.$keepAliveDestroy(e)}))},t.removeGreater=function(e){for(;this.historyStackMap.length>=e;)this.pop()},t.clear=function(){this.historyStackMap=[]},e}(),l=function(){function t(e){var t=e.Vue,n=e.router,o=e.replaceStay;this.Vue=t,this.router=n,this.router._stack=0,this.mode=n.mode,this.historyShouldChange=!1,this.isReplace=!1,this.replacePrePath=void 0,this.preStateId=0,this.pre=null,this.replaceStay=o||[],this.hacked=!1,this.historyStack=new u,this.init()}var r,h,p,l=t.prototype;return l.init=function(){this.routerHooks(),this.hackRouter()},l.routerHooks=function(){var e=this,t=this.router;t.afterEach((function(i,r){e.historyShouldChange=!0,e.Vue.nextTick((function(){var i,r,c=e.currentVm,h=n(i=c)&&i.$vnode.data.keepAlive?i:o;null===e.pre?e.onInitial(h):e.isReplace?e.onReplace(h):e.isPush?e.onPush(h):e.onBack(h),e.pre=c,e.preStateId=e.stackPointer,(r=h)&&r.__placeholder||(!function(e,t){var n=a(e);n&&n._vnode&&(n._vnode.parent.key=t)}(t,s(e.stackPointer,t)),!e.hacked&&c&&e.hackKeepAliveRender(c.$vnode.parent.componentInstance),e.historyShouldChange=!1)}))}))},l.hackRouter=function(){var e=this,t=this.router,o=t.replace;t.replace=function(i,r,s){!function(i,r,s){e.isReplace=!0,e.replacePrePath=t.history.current.path,o.call(t,i,r,(function(t){e.isReplace=!1,e.replacePrePath=void 0,n(s)&&s(t)}))}(i,r,s)};var i=t.go;t.go=function(n){return o=n,e.isReplace=!1,i.call(t,o);var o};var r=t.push;t.push=function(n,o,i){return function(n,o,i){if(e.isReplace=!1,!o&&!i&&"undefined"!=typeof Promise)return r.call(t,n,o,i);r.call(t,n,o,i)}(n,o,i)}},l.hackKeepAliveRender=function(e){!function(e,t){if(n(e)&&n(e.cache)&&n(e.keys)){var o=e.keys,i=e.cache;if(1===o.length){var r=i[o[0]];delete i[o[0]],o.splice(0,1),o.push(t),i[t]=r}}}(e,s(this.stackPointer,this.router));var t=e.$options.render,o=this,i=this.router;e.$options.render=function(){var e=this.$slots.default,r=c(e);return o.historyShouldChange?r&&!n(r.key)&&(o.isReplace?r.key=s(o.stackPointer,i):o.isPush?r.key=s(o.stackPointer+1,i):r.key=s(o.stackPointer-1,i)):r.key=s(o.stackPointer,i),t.apply(this,arguments)},this.hacked=!0},l.onInitial=function(e){var t=i();n(t)?this.setStackPointer(t):this.setState(0),this.historyStack.push(e,this.stackPointer)},l.onPush=function(e){this.setState(this.increaseStackPointer()),this.historyStack.push(e,this.stackPointer)},l.onBack=function(e){this.historyStack.pop(e),this.decreaseStackPointer(),this.historyStack.push(e,this.stackPointer)},l.onReplace=function(e){var t,o;n(this.replacePrePath)&&this.replaceStay.includes(this.replacePrePath)?(null==(o=this.pre)||null==o.$clearParent||o.$clearParent(e),this.pre=null):(null==(t=this.pre)||null==t.$keepAliveDestroy||t.$keepAliveDestroy(e),this.pre=null);this.setState(this.stackPointer),this.historyStack.push(e,this.stackPointer),this.isReplace=!1,this.replacePrePath=void 0},l.setState=function(e){this.setStackPointer(e),function(e,t,o){var i=window.location,r=""+i.pathname+i.search+i.hash,s=n(history.state)?history.state:{};s.id=o;var a=window.location.href.startsWith("file://");history.replaceState(s,"",a?null:r)}(this.mode,this.router,e)},l.setStackPointer=function(e){this.router._stack=e},l.increaseStackPointer=function(){return this.router._stack+=1},l.decreaseStackPointer=function(){return this.router._stack-=1},r=t,(h=[{key:"currentVm",get:function(){return a(this.router)}},{key:"isPush",get:function(){if(!this.isReplace){var e=i();return!n(e)||this.preStateId<=e}return!1}},{key:"stackPointer",get:function(){return this.router._stack}}])&&e(r.prototype,h),p&&e(r,p),t}();return function(e){var o,i;if(void 0!==e.Vue&&void 0!==e.router)return t||(p&&function(e){var t=e.replaceState;e.replaceState=function(n,o,i){var r=Object.assign({},e.state),s=Object.assign(r,n);t.call(e,s,o,i)};var n=e.pushState;e.pushState=function(t,o,i){var r=Object.assign({},e.state),s=Object.assign(r,t);n.call(e,s,o,i)}}(window.history),o=e.Vue,i=o.prototype.$destroy,o.prototype.$keepAliveDestroy=function(e){if(this.$vnode&&this.$vnode.data.keepAlive&&this.$vnode.parent&&this.$vnode.parent.componentInstance&&this.$vnode.parent.componentInstance.cache&&this.$vnode.componentOptions){var t=n(this.$vnode.key)?this.$vnode.key:this.$vnode.componentOptions.Ctor.cid+(this.$vnode.componentOptions.tag?"::"+this.$vnode.componentOptions.tag:""),o=this.$vnode.parent.componentInstance.cache,r=this.$vnode.parent.componentInstance.keys;if(o[t]){if(r.length){var s=r.indexOf(t);s>-1&&r.splice(s,1)}if(o[t]=null,this.$vnode.parent&&this.$vnode.parent.componentOptions&&this.$vnode.parent.componentOptions.children&&Array.isArray(this.$vnode.parent.componentOptions.children)&&(this.$vnode.parent.componentOptions.children.length=0),o[e.$vnode.key]&&o[e.$vnode.key].parent&&o[e.$vnode.key].parent.componentOptions&&(o[e.$vnode.key].parent.componentOptions.children=[o[e.$vnode.key]],o[e.$vnode.key].parent.elm=o[e.$vnode.key].parent.componentInstance.$el),this.$parent.$children&&Array.isArray(this.$parent.$children)){var a=this.$parent.$children.indexOf(this);a>=0&&this.$parent.$children.splice(a,1)}}}i.apply(this,arguments)},o.prototype.$clearParent=function(e){if(this.$vnode&&this.$vnode.data.keepAlive&&this.$vnode.parent&&this.$vnode.parent.componentInstance&&this.$vnode.parent.componentInstance.cache&&this.$vnode.componentOptions){var t=n(this.$vnode.key)?this.$vnode.key:this.$vnode.componentOptions.Ctor.cid+(this.$vnode.componentOptions.tag?"::"+this.$vnode.componentOptions.tag:""),o=this.$vnode.parent.componentInstance.cache;o[t]&&(this.$vnode.parent&&this.$vnode.parent.componentOptions&&this.$vnode.parent.componentOptions.children&&Array.isArray(this.$vnode.parent.componentOptions.children)&&(this.$vnode.parent.componentOptions.children.length=0),o[e.$vnode.key]&&o[e.$vnode.key].parent&&o[e.$vnode.key].parent.componentOptions&&(o[e.$vnode.key].parent.componentOptions.children=[o[e.$vnode.key]],o[e.$vnode.key].parent.elm=o[e.$vnode.key].parent.componentInstance.$el))}},t=new l(e));console.warn("warning: router helper needs Vue and root router ,see more for guide : https://github.com/Zippowxk/vue-router-keep-alive-helper")}}));
//# sourceMappingURL=index.js.map
