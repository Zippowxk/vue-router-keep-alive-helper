function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var e,n=function(t){return null!=t},i={__placeholder:!0},r=function(){var t=o();return n(t)?t.id:void 0},o=function(){return history.state},a=function(t,e){return"keep-alive-vnode-key"+Number(t)+e.history.current.path},s=function(t){return t.history.current.matched.length>0?t.history.current.matched[0].instances.default:void 0},c=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];if(n(i)&&(n(i.componentOptions)||p(i)))return i}},h=function t(e){var n=e&&e.componentOptions;return n&&n.Ctor.options.abstract?t(c(n.children)):e},p=function(t){return t.isComment&&t.asyncFactory},u="undefined"!=typeof window,l=function(){function t(){this.historyStackMap=[]}var e=t.prototype;return e.push=function(t,e){var n=this.historyStackMap[e];if(Array.isArray(n))!n.includes(t)&&n.push(t),this.historyStackMap[e]=n.filter((function(t){return!t._isDestroyed}));else{var i=[];i.push(t),this.historyStackMap[e]=i}},e.pop=function(t){var e=this.historyStackMap.pop();Array.isArray(e)&&e.forEach((function(e){return e&&e.$keepAliveDestroy&&e.$keepAliveDestroy(t)}))},e.removeGreater=function(t){for(;this.historyStackMap.length>=t;)this.pop()},e.clear=function(){this.historyStackMap=[]},t}(),d=function(){function e(t){var e=t.Vue,n=t.router,i=t.replaceStay;this.Vue=e,this.router=n,this.router._stack=0,this.mode=n.mode,this.historyShouldChange=!1,this.isReplace=!1,this.replacePrePath=void 0,this.preStateId=0,this.pre=null,this.replaceStay=i||[],this.hacked=!1,this.historyStack=new l,this.getTransitionName=function(){},this.init()}var o,p,u,d=e.prototype;return d.init=function(){this.routerHooks(),this.hackRouter()},d.setTransitionNameHandler=function(t){this.getTransitionName=t},d.routerHooks=function(){var t=this,e=this.router;e.afterEach((function(r,o){!function(t){var e=window.location,i=""+e.pathname+e.search+e.hash,r=n(history.state)?history.state:{};r.__forward=t;var o=window.location.href.startsWith("file://");history.replaceState(r,"",o?null:i)}(r.fullPath),t.historyShouldChange=!0,t.Vue.nextTick((function(){var r,o,c=t.currentVm,h=n(r=c)&&r.$vnode.data.keepAlive?r:i;if(null===t.pre?t.onInitial(h):t.isReplace?t.onReplace(h):t.isPush?t.onPush(h):t.onBack(h),t.pre=c,t.preStateId=t.stackPointer,!(o=h)||!o.__placeholder){var p,u,l,d;if(function(t,e){var n=s(t);n&&n._vnode&&(n._vnode.parent.key=e)}(e,a(t.stackPointer,e)),!t.hacked&&c)if(t.hackKeepAliveRender(c.$vnode.parent.componentInstance),"transition"===(null==(p=c.$vnode.parent)||null==(u=p.parent)||null==(l=u.componentOptions)?void 0:l.tag))t.hackTransitionRender(null==(d=c.$vnode.parent)?void 0:d.parent.componentInstance);t.historyShouldChange=!1}}))}))},d.hackRouter=function(){var t=this,e=this.router,i=e.replace;e.replace=function(r,o,a){!function(r,o,a){t.isReplace=!0,t.replacePrePath=e.history.current.path,i.call(e,r,o,(function(e){t.isReplace=!1,t.replacePrePath=void 0,n(a)&&a(e)}))}(r,o,a)};var r=e.go;e.go=function(n){return i=n,t.isReplace=!1,r.call(e,i);var i};var o=e.push;e.push=function(n,i,r){return function(n,i,r){if(t.isReplace=!1,!i&&!r&&"undefined"!=typeof Promise)return o.call(e,n,i,r);o.call(e,n,i,r)}(n,i,r)}},d.hackKeepAliveRender=function(t){!function(t,e){if(n(t)&&n(t.cache)&&n(t.keys)){var i=t.keys,r=t.cache;if(1===i.length){var o=r[i[0]];delete r[i[0]],i.splice(0,1),i.push(e),r[e]=o}}}(t,a(this.stackPointer,this.router));var e=t.$options.render,i=this,r=this.router;t.$options.render=function(){var t=this.$slots.default,o=c(t);return i.historyShouldChange?o&&!n(o.key)&&(i.isReplace?o.key=a(i.stackPointer,r):i.isPush?o.key=a(i.stackPointer+1,r):o.key=a(i.stackPointer-1,r)):o&&!n(o.key)&&(o.key=a(i.stackPointer,r)),e.apply(this,arguments)},this.hacked=!0},d.hackTransitionRender=function(t){var e=t.$options.render,i=this,r=this.router;t.$options.render=function(){var t=this.$slots.default,o="";if(t.length>0){var s=h(t[0]);i.historyShouldChange?s&&!n(s.key)&&(i.isReplace?s.key=a(i.stackPointer,r):i.isPush?s.key=a(i.stackPointer+1,r):s.key=a(i.stackPointer-1,r)):s&&!n(s.key)&&(s.key=a(i.stackPointer,r)),o=s.key}var c=e.apply(this,arguments);if(o.length>0){var p=h(t[0]);if(p.key=o,p&&p.data&&p.data.transition&&(p.data.transition.name=i.getTransitionName(),t&&t.length>0&&t[0]&&t[0].context.$children)){var u=t[0].context.$children.length,l=t[0].context.$children[u-1].$vnode;l&&l.data&&l.data.transition&&(l.data.transition.name=i.getTransitionName())}}return c}},d.onInitial=function(t){var e=r();n(e)?this.setStackPointer(e):this.setState(0),this.historyStack.push(t,this.stackPointer)},d.onPush=function(t){var e;this.setState(this.increaseStackPointer()),this.historyStack.push(t,this.stackPointer),null==(e=this.pre)||null==e.$clearParent||e.$clearParent(t),this.pre=null},d.onBack=function(t){this.historyStack.pop(t),this.decreaseStackPointer(),this.historyStack.push(t,this.stackPointer)},d.onReplace=function(t){var e,i=this.replacePrePath===this.router.history.current.path;if(n(this.replacePrePath)&&this.replaceStay.includes(this.replacePrePath)||i){if(!i){var r;null==(r=this.pre)||null==r.$clearParent||r.$clearParent(t)}}else null==(e=this.pre)||null==e.$keepAliveDestroy||e.$keepAliveDestroy(t);this.pre=null,this.setState(this.stackPointer),this.historyStack.push(t,this.stackPointer),this.isReplace=!1,this.replacePrePath=void 0},d.setState=function(t){this.setStackPointer(t),function(t,e,i){var r=window.location,o=""+r.pathname+r.search+r.hash,a=n(history.state)?history.state:{};a.id=i;var s=window.location.href.startsWith("file://");history.replaceState(a,"",s?null:o)}(this.mode,this.router,t)},d.setStackPointer=function(t){this.router._stack=t},d.increaseStackPointer=function(){return this.router._stack+=1},d.decreaseStackPointer=function(){return this.router._stack-=1},o=e,(p=[{key:"isBacking",get:function(){return!(this.isPush||this.isReplace)}},{key:"currentVm",get:function(){return s(this.router)}},{key:"isPush",get:function(){if(!this.isReplace){var t=r();return!n(t)||this.preStateId<=t}return!1}},{key:"stackPointer",get:function(){return this.router._stack}}])&&t(o.prototype,p),u&&t(o,u),e}();function v(t){return e||(void 0!==t.Vue&&void 0!==t.router?(u&&function(t){var e=t.replaceState;t.replaceState=function(n,i,r){var o=Object.assign({},t.state),a=Object.assign(o,n);e.call(t,a,i,r)};var n=t.pushState;t.pushState=function(e,i,r){var o=Object.assign({},t.state),a=Object.assign(o,e);n.call(t,a,i,r)}}(window.history),i=t.Vue,r=i.prototype.$destroy,i.prototype.$keepAliveDestroy=function(t){if(this.$vnode&&this.$vnode.data.keepAlive&&this.$vnode.parent&&this.$vnode.parent.componentInstance&&this.$vnode.parent.componentInstance.cache&&this.$vnode.componentOptions){var e=n(this.$vnode.key)?this.$vnode.key:this.$vnode.componentOptions.Ctor.cid+(this.$vnode.componentOptions.tag?"::"+this.$vnode.componentOptions.tag:""),i=this.$vnode.parent.componentInstance.cache,o=this.$vnode.parent.componentInstance.keys;if(i[e]){if(o.length){var a=o.indexOf(e);a>-1&&o.splice(a,1)}if(i[e]=null,this.$vnode.parent&&this.$vnode.parent.componentOptions&&this.$vnode.parent.componentOptions.children&&Array.isArray(this.$vnode.parent.componentOptions.children)&&(this.$vnode.parent.componentOptions.children.length=0),i[t.$vnode.key]&&i[t.$vnode.key].parent&&i[t.$vnode.key].parent.componentOptions&&(i[t.$vnode.key].parent.componentOptions.children=[i[t.$vnode.key]],i[t.$vnode.key].parent.elm=i[t.$vnode.key].parent.componentInstance.$el),this.$parent.$children&&Array.isArray(this.$parent.$children)){var s=this.$parent.$children.indexOf(this);s>=0&&this.$parent.$children.splice(s,1)}}}r.apply(this,arguments)},i.prototype.$clearParent=function(t){if(this.$vnode&&this.$vnode.data.keepAlive&&this.$vnode.parent&&this.$vnode.parent.componentInstance&&this.$vnode.parent.componentInstance.cache&&this.$vnode.componentOptions){var e=n(this.$vnode.key)?this.$vnode.key:this.$vnode.componentOptions.Ctor.cid+(this.$vnode.componentOptions.tag?"::"+this.$vnode.componentOptions.tag:""),i=this.$vnode.parent.componentInstance.cache;i[e]&&(this.$vnode.parent&&this.$vnode.parent.componentOptions&&this.$vnode.parent.componentOptions.children&&Array.isArray(this.$vnode.parent.componentOptions.children)&&(this.$vnode.parent.componentOptions.children.length=0),i[t.$vnode.key]&&i[t.$vnode.key].parent&&i[t.$vnode.key].parent.componentOptions&&(i[t.$vnode.key].parent.componentOptions.children=[i[t.$vnode.key]],i[t.$vnode.key].parent.elm=i[t.$vnode.key].parent.componentInstance.$el))}},e=new d(t)):void console.warn("warning: router helper needs Vue and root router ,see more for guide : https://github.com/Zippowxk/vue-router-keep-alive-helper"));var i,r}export default v;
//# sourceMappingURL=helper.esm.js.map
